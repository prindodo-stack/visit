<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>들락날락 - 창의융합교육원 급식관리</title>
    <!-- 라이브러리 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .custom-shadow { box-shadow: 0 10px 30px -5px rgba(28, 7, 112, 0.08); }
        .off-day-pattern { background: repeating-linear-gradient(45deg, #f8fafc, #f8fafc 10px, #f1f5f9 10px, #f1f5f9 20px); }
        .sidebar-active { background-color: #261CC1; color: white; box-shadow: 0 10px 20px -5px rgba(38, 28, 193, 0.4); }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; filter: invert(15%) sepia(95%) saturate(3935%) hue-rotate(244deg) brightness(85%) contrast(105%); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        /**
         * 아이콘 컴포넌트: Lucide 아이콘을 브라우저 환경에서 안전하게 렌더링
         */
        const Icon = ({ name, size = 20, className = "", color = "currentColor", strokeWidth = 2.5 }) => {
            const iconRef = useRef(null);
            
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconElement = document.createElement('i');
                    // lucide 라이브러리의 명명 규칙에 맞게 변환 (CamelCase -> kebab-case)
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    iconElement.setAttribute('data-lucide', kebabName);
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    iconElement.style.display = 'inline-block';
                    if (color) iconElement.style.color = color;
                    
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons({
                        icons: window.lucide.icons,
                        attrs: {
                            'stroke-width': strokeWidth,
                            width: size,
                            height: size
                        },
                        elements: [iconElement]
                    });
                }
            }, [name, size, color, strokeWidth, className]);

            return <span ref={iconRef} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        // --- 시스템 설정 ---
        const SUPABASE_URL = 'https://zyuybhszykxuafzriksn.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_3h3_2LRYgdyeXdoDO6XZMA_4jQrQTtV'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const WEEKDAYS = ["일", "월", "화", "수", "목", "금", "토"];
        const ADMIN_PASSWORD = "1416";
        const COLORS = { deep: '#1C0770', royal: '#261CC1', sky: '#3A9AFF', lime: '#F1FF5E' };

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(false);
            const [viewMode, setViewMode] = useState('day');
            const [viewDate, setViewDate] = useState(new Date());
            
            const [notification, setNotification] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [pwInput, setPwInput] = useState("");

            const [baseSettings, setBaseSettings] = useState({ 
                maxCapacity: 220, 
                baseMealCount: 45,
                operatingDays: [false, true, true, true, true, true, false]
            });
            const [excludedDates, setExcludedDates] = useState([]);

            const [formData, setFormData] = useState({
                event_date: new Date().toISOString().split('T')[0],
                department: '기획부',
                event_name: '',
                total_participants: 0,
                meal_participants: 0
            });

            const fileInputRef = useRef(null);

            const showMsg = (message, type = 'info') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const initData = async () => {
                setLoading(true);
                try {
                    const { data: sData } = await supabaseClient.from('site_settings').select('*').eq('id', 1).single();
                    if (sData) {
                        setBaseSettings({
                            maxCapacity: Number(sData.max_capacity || 220),
                            baseMealCount: Number(sData.base_meal_count || 45),
                            operatingDays: sData.operating_days || [false, true, true, true, true, true, false]
                        });
                    }
                    const { data: eDates } = await supabaseClient.from('excluded_dates').select('date_str');
                    if (eDates) setExcludedDates(eDates.map(d => d.date_str));
                    const { data: evData } = await supabaseClient.from('events').select('*').order('event_date', { ascending: true });
                    if (evData) setEvents(evData);
                } catch (err) { console.error(err); } finally { setLoading(false); }
            };

            useEffect(() => { initData(); }, []);

            const navigateDate = (direction) => {
                const nextDate = new Date(viewDate);
                if (viewMode === 'day') nextDate.setDate(viewDate.getDate() + direction);
                else if (viewMode === 'week') nextDate.setDate(viewDate.getDate() + (direction * 7));
                else if (viewMode === 'month') nextDate.setMonth(viewDate.getMonth() + direction);
                setViewDate(nextDate);
            };

            const filteredData = useMemo(() => {
                const start = new Date(viewDate);
                const end = new Date(viewDate);
                start.setHours(0, 0, 0, 0);
                end.setHours(23, 59, 59, 999);

                if (viewMode === 'week') {
                    const day = start.getDay();
                    start.setDate(start.getDate() - day);
                    const lastDay = new Date(start);
                    lastDay.setDate(start.getDate() + 6);
                    end.setTime(lastDay.getTime());
                    end.setHours(23, 59, 59, 999);
                } else if (viewMode === 'month') {
                    start.setDate(1); end.setMonth(start.getMonth() + 1); end.setDate(0);
                    end.setHours(23, 59, 59, 999);
                }

                let rangeDays = [];
                const tempDate = new Date(start);
                while (tempDate <= end) {
                    const dateStr = tempDate.toISOString().split('T')[0];
                    const dayIdx = tempDate.getDay();
                    const isOperating = baseSettings.operatingDays[dayIdx] && !excludedDates.includes(dateStr);
                    const dayEvents = events.filter(e => e.event_date === dateStr);
                    const sumTotal = dayEvents.reduce((s, e) => s + Number(e.total_participants || 0), 0);
                    const sumMeals = dayEvents.reduce((s, e) => s + Number(e.meal_participants || 0), 0);
                    const totalMeals = isOperating ? (Number(baseSettings.baseMealCount) + sumMeals) : 0;
                    const remaining = isOperating ? (baseSettings.maxCapacity - totalMeals) : 0;

                    rangeDays.push({
                        dateStr, dayLabel: WEEKDAYS[dayIdx],
                        shortDate: `${tempDate.getMonth() + 1}/${tempDate.getDate()}`,
                        isOperating, total: sumTotal, meals: totalMeals, remaining, events: dayEvents
                    });
                    tempDate.setDate(tempDate.getDate() + 1);
                }

                return {
                    items: rangeDays,
                    summary: { 
                        total: rangeDays.reduce((sum, d) => sum + d.total, 0), 
                        meals: rangeDays.reduce((sum, d) => sum + d.meals, 0) 
                    },
                    periodLabel: viewMode === 'month' ? `${viewDate.getFullYear()}년 ${viewDate.getMonth() + 1}월` : 
                                 viewMode === 'day' ? `${viewDate.getFullYear()}년 ${viewDate.getMonth() + 1}월 ${viewDate.getDate()}일` :
                                 `${start.toLocaleDateString('ko-KR', {month:'long', day:'numeric'})} ~ ${end.toLocaleDateString('ko-KR', {month:'long', day:'numeric'})}`
                };
            }, [events, viewMode, viewDate, baseSettings, excludedDates]);

            const saveSettings = async () => {
                setLoading(true);
                try {
                    const { error } = await supabaseClient.from('site_settings').update({
                        max_capacity: Number(baseSettings.maxCapacity),
                        base_meal_count: Number(baseSettings.baseMealCount),
                        operating_days: baseSettings.operating_days
                    }).eq('id', 1);
                    if (error) throw error;
                    showMsg("설정이 성공적으로 저장되었습니다.", "success");
                } catch (err) { showMsg("저장 실패", "error"); } finally { setLoading(false); }
            };

            const toggleExcludedDate = async (dateStr) => {
                if (!isAdmin) { showMsg("관리자 인증 후 이용 가능합니다.", "error"); return; }
                try {
                    if (excludedDates.includes(dateStr)) {
                        await supabaseClient.from('excluded_dates').delete().eq('date_str', dateStr);
                        setExcludedDates(prev => prev.filter(d => d !== dateStr));
                    } else {
                        await supabaseClient.from('excluded_dates').insert([{ date_str: dateStr }]);
                        setExcludedDates(prev => [...prev, dateStr]);
                    }
                } catch (err) { console.error(err); }
            };

            const handleExcelUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (evt) => {
                    setLoading(true);
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary' });
                        const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                        const mapped = data.map(item => ({
                            event_date: typeof item['날짜'] === 'number' ? new Date((item['날짜'] - 25569) * 86400 * 1000).toISOString().split('T')[0] : (item['날짜'] || new Date().toISOString().split('T')[0]),
                            department: String(item['부서'] || '기타'),
                            event_name: String(item['행사명'] || '미지정 행사'),
                            total_participants: Number(item['참석인원'] || 0),
                            meal_participants: Number(item['급식인원'] || 0)
                        }));
                        const { error } = await supabaseClient.from('events').insert(mapped);
                        if (error) throw error;
                        showMsg(`${mapped.length}건 등록 완료`, "success");
                        initData();
                        setActiveTab('list');
                    } catch (err) { showMsg("파일 처리 오류", "error"); } finally { setLoading(false); if(fileInputRef.current) fileInputRef.current.value=""; }
                };
                reader.readAsBinaryString(file);
            };

            // 누락되었던 handleSubmitEvent 함수 정의
            const handleSubmitEvent = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { error } = await supabaseClient.from('events').insert([{
                        event_date: formData.event_date,
                        department: formData.department,
                        event_name: formData.event_name,
                        total_participants: Number(formData.total_participants),
                        meal_participants: Number(formData.meal_participants)
                    }]);
                    if (error) throw error;
                    setFormData({ ...formData, event_name: '', total_participants: 0, meal_participants: 0 });
                    showMsg("행사가 성공적으로 등록되었습니다.", "success");
                    initData();
                    setActiveTab('list');
                } catch (err) {
                    showMsg("등록 중 오류가 발생했습니다.", "error");
                } finally {
                    setLoading(false);
                }
            };

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if (pwInput === ADMIN_PASSWORD) {
                    setIsAdmin(true); setPwInput(""); showMsg("마스터 권한이 활성화되었습니다.", "success");
                } else {
                    showMsg("비밀번호가 올바르지 않습니다.", "error");
                }
            };

            const deleteEvent = async (id) => {
                if(!window.confirm("정말 삭제하시겠습니까?")) return;
                setLoading(true);
                try {
                    const { error } = await supabaseClient.from('events').delete().eq('id', id);
                    if (error) throw error;
                    showMsg("삭제 완료", "success");
                    initData();
                } catch (err) { showMsg("삭제 실패", "error"); } finally { setLoading(false); }
            };

            const safeLocaleString = (val) => (Number(val) || 0).toLocaleString();

            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-[#f8fafc] text-[#1C0770]">
                    {/* 알림 배너 */}
                    {notification && (
                        <div className="fixed top-6 left-1/2 -translate-x-1/2 z-[100] animate-fadeIn">
                            <div className="px-6 py-4 rounded-2xl shadow-2xl flex items-center space-x-4 bg-white border-l-8" style={{borderLeftColor: notification.type==='success'?COLORS.lime:COLORS.royal}}>
                                <Icon name={notification.type === 'error' ? "AlertTriangle" : "Info"} size={20} color={notification.type === 'error' ? '#ef4444' : '#261CC1'} />
                                <span className="font-bold text-sm">{notification.message}</span>
                            </div>
                        </div>
                    )}

                    {/* 사이드바 */}
                    <nav className="w-full md:w-72 bg-[#1C0770] text-white p-6 flex flex-col shrink-0 z-30 shadow-2xl">
                        <div className="mb-12 flex items-center space-x-3 px-2">
                            <div className="p-2.5 rounded-xl shadow-lg flex items-center justify-center" style={{backgroundColor: COLORS.lime}}>
                                <Icon name="Utensils" size={24} color="#1C0770" />
                            </div>
                            <div>
                                <h1 className="text-2xl font-black italic leading-none tracking-tighter">들락날락</h1>
                                <p className="text-[9px] text-[#3A9AFF] font-black uppercase mt-1 tracking-widest">창의융합교육원 CMS</p>
                            </div>
                        </div>
                        <div className="space-y-2 flex-1">
                            {[
                                { id: 'dashboard', icon: 'LayoutDashboard', label: '통계 대시보드' },
                                { id: 'list', icon: 'ListOrdered', label: '행사 내역 조회' },
                                { id: 'add', icon: 'PlusCircle', label: '신규 행사 등록' },
                                { id: 'admin', icon: 'Settings', label: '시스템 설정' }
                            ].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} 
                                    className={`w-full flex items-center space-x-4 px-5 py-4 rounded-2xl transition-all font-black text-sm ${activeTab === item.id ? 'sidebar-active' : 'text-slate-400 hover:bg-white/5 hover:text-white'}`}>
                                    <Icon name={item.icon} size={18}/> <span>{item.label}</span>
                                </button>
                            ))}
                        </div>
                        <div className="mt-8 p-5 bg-white/5 rounded-2xl border border-white/10 flex items-center justify-between">
                            <div className="flex flex-col text-slate-400">
                                <span className="text-[10px] font-bold uppercase tracking-tight">Access</span>
                                <span className="text-[11px] font-black text-white">{isAdmin ? 'ADMIN' : 'STANDARD'}</span>
                            </div>
                            <Icon name="RefreshCcw" size={14} className={`${loading ? 'animate-spin' : ''} text-[#3A9AFF]`} />
                        </div>
                    </nav>

                    {/* 메인 섹션 */}
                    <main className="flex-1 p-6 md:p-12 overflow-y-auto bg-[#f8fafc]">
                        {activeTab === 'dashboard' && (
                            <div className="max-w-6xl mx-auto space-y-10 animate-fadeIn">
                                {/* 헤더 및 네비게이션 */}
                                <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-6 bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                                    <div className="space-y-2">
                                        <h2 className="text-3xl font-black text-[#1C0770] tracking-tight">현황 모니터링</h2>
                                        <div className="flex items-center gap-3 mt-1 text-[#261CC1]">
                                            <Icon name="CalendarDays" size={18} color="#3A9AFF" />
                                            <span className="font-black text-lg tracking-tight">{filteredData.periodLabel}</span>
                                            <div className="w-2 h-2 bg-[#F1FF5E] rounded-full animate-pulse shadow-[0_0_8px_#F1FF5E]"></div>
                                        </div>
                                    </div>
                                    
                                    <div className="flex flex-wrap items-center gap-4">
                                        <div className="flex bg-[#f1f5f9] p-1.5 rounded-2xl shadow-inner border border-slate-200">
                                            {['day', 'week', 'month'].map(m => (
                                                <button key={m} onClick={() => setViewMode(m)} className={`px-5 py-2.5 rounded-xl text-xs font-black transition-all ${viewMode === m ? 'bg-white text-[#1C0770] shadow-md' : 'text-slate-400 hover:text-[#261CC1]'}`}>
                                                    {m === 'day' ? '일간' : m === 'week' ? '주간' : '월간'}
                                                </button>
                                            ))}
                                        </div>
                                        
                                        <div className="flex items-center bg-[#1C0770] rounded-2xl shadow-xl overflow-hidden border border-[#1C0770]">
                                            <button onClick={() => navigateDate(-1)} className="p-3.5 hover:bg-[#261CC1] transition text-white border-r border-white/10">
                                                <Icon name="ChevronLeft" size={24} color="white" />
                                            </button>
                                            <button onClick={() => {setViewDate(new Date()); setViewMode('day');}} className="px-6 py-3 text-xs font-black text-[#F1FF5E] hover:bg-[#261CC1] transition uppercase tracking-[0.15em] border-r border-white/10">Today</button>
                                            <button onClick={() => navigateDate(1)} className="p-3.5 hover:bg-[#261CC1] transition text-white">
                                                <Icon name="ChevronRight" size={24} color="white" />
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="bg-white p-12 rounded-[3.5rem] shadow-sm border-b-[10px] border-[#261CC1] flex flex-col justify-between group hover:shadow-2xl transition-all">
                                        <p className="text-xs font-black text-[#261CC1] uppercase tracking-widest flex items-center gap-2 italic"><Icon name="Users" size={18} color="#261CC1"/> Total Visitors</p>
                                        <div className="flex items-baseline space-x-1 mt-8">
                                            <h3 className="text-7xl font-black tracking-tighter text-[#1C0770]">{safeLocaleString(filteredData.summary.total)}</h3>
                                            <span className="text-slate-300 font-black text-2xl ml-2">명</span>
                                        </div>
                                    </div>
                                    <div className="bg-white p-12 rounded-[3.5rem] shadow-sm border-b-[10px] border-[#3A9AFF] flex flex-col justify-between group hover:shadow-2xl transition-all">
                                        <p className="text-xs font-black text-[#3A9AFF] uppercase tracking-widest flex items-center gap-2 italic"><Icon name="CheckCircle2" size={18} color="#3A9AFF"/> {viewMode==='day'?'일일':viewMode==='week'?'주간':'월간'} 급식 예상 총원</p>
                                        <div className="flex items-baseline space-x-1 mt-8">
                                            <h3 className="text-7xl font-black tracking-tighter text-[#261CC1]">{safeLocaleString(filteredData.summary.meals)}</h3>
                                            <span className="text-slate-300 font-black text-2xl ml-2">명</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white p-10 md:p-12 rounded-[4rem] shadow-sm border border-slate-100 overflow-hidden relative custom-shadow">
                                    <div className="flex items-center justify-between mb-12">
                                        <h3 className="text-2xl font-black text-[#1C0770] tracking-tight">데일리 운영 상세 내역</h3>
                                        <div className="hidden sm:flex gap-4 bg-slate-50 p-3 px-6 rounded-2xl border border-slate-100">
                                            <div className="flex items-center text-[10px] font-black text-[#261CC1] uppercase"><div className="w-3.5 h-3.5 bg-[#261CC1] rounded-full mr-2 shadow-sm"></div>Guest</div>
                                            <div className="flex items-center text-[10px] font-black text-[#3A9AFF] uppercase ml-2"><div className="w-3.5 h-3.5 bg-[#3A9AFF] rounded-full mr-2 shadow-sm"></div>Meal</div>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-12 px-10 py-3 text-[10px] font-black text-slate-300 uppercase hidden md:grid tracking-[0.2em]">
                                            <div className="col-span-2">Date</div>
                                            <div className="col-span-3">Visitors</div>
                                            <div className="col-span-3">Meals</div>
                                            <div className="col-span-2">Capacity</div>
                                            <div className="col-span-2 text-right">Status</div>
                                        </div>
                                        {filteredData.items.map((item, i) => {
                                            const isOver = item.meals > baseSettings.maxCapacity;
                                            return (
                                                <div key={i} onClick={() => isAdmin && toggleExcludedDate(item.dateStr)}
                                                    className={`grid grid-cols-1 md:grid-cols-12 items-center px-10 py-6 rounded-[2.5rem] border transition-all ${isAdmin ? 'cursor-pointer hover:border-[#3A9AFF]/60 hover:shadow-xl hover:-translate-y-1' : ''} ${!item.isOperating ? 'opacity-40 border-transparent off-day-pattern' : isOver ? 'bg-red-50/40 border-red-100 shadow-sm shadow-red-50/50' : 'bg-white border-slate-100 hover:border-slate-200'}`}>
                                                    <div className="col-span-1 md:col-span-2">
                                                        <span className={`text-lg font-black ${item.dayLabel === '일' ? 'text-red-500' : item.dayLabel === '토' ? 'text-[#3A9AFF]' : 'text-[#1C0770]'}`}>{item.dayLabel}요일</span>
                                                        <p className="text-[11px] font-bold text-slate-400 mt-0.5">{item.shortDate}</p>
                                                    </div>
                                                    <div className="col-span-1 md:col-span-3 font-black text-slate-700 text-lg"><span className="text-[#261CC1]">{item.total}</span> 명</div>
                                                    <div className="col-span-1 md:col-span-3 font-black text-slate-700 text-lg"><span className="text-[#3A9AFF]">{item.meals}</span> 명</div>
                                                    <div className="col-span-1 md:col-span-2">
                                                        <div className={`px-4 py-1.5 w-fit rounded-full text-[11px] font-black border flex items-center gap-2 ${item.remaining < 0 ? 'bg-red-100 text-red-600 border-red-200 shadow-inner' : 'bg-[#3A9AFF]/5 text-[#3A9AFF] border-[#3A9AFF]/20'}`}>
                                                            {item.remaining < 0 && <Icon name="AlertTriangle" size={12} color="#dc2626"/>}
                                                            {item.remaining}명 여유
                                                        </div>
                                                    </div>
                                                    <div className="col-span-1 md:col-span-2 text-right">
                                                        {item.isOperating ? <span className="text-[10px] bg-[#F1FF5E] text-[#1C0770] px-5 py-2 rounded-full font-black uppercase tracking-widest border border-[#1C0770]/10 shadow-sm">Open</span> : <span className="text-[10px] bg-slate-100 text-slate-400 px-5 py-2 rounded-full font-black uppercase tracking-widest">Closed</span>}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <div className="max-w-6xl mx-auto space-y-12 animate-fadeIn">
                                <div className="text-center space-y-3">
                                    <h2 className="text-5xl font-black italic tracking-tighter uppercase text-[#1C0770]">Registration</h2>
                                    <p className="text-slate-400 font-black tracking-wide">신규 정보를 입력하거나 대량의 데이터를 업로드하세요.</p>
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                                    <div className="bg-white p-12 rounded-[3.5rem] shadow-sm border border-slate-100 space-y-10 flex flex-col custom-shadow">
                                        <div className="flex items-center space-x-3 pb-6 border-b border-slate-50">
                                            <Icon name="FileText" size={26} color="#3A9AFF" />
                                            <h3 className="text-2xl font-black text-[#1C0770]">개별 정보 입력</h3>
                                        </div>
                                        <form onSubmit={handleSubmitEvent} className="space-y-8">
                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Date</label><input type="date" required className="w-full p-5 bg-[#f8fafc] rounded-2xl font-bold border-none outline-none shadow-inner focus:ring-2 focus:ring-[#3A9AFF]" value={formData.event_date} onChange={e => setFormData({...formData, event_date: e.target.value})} /></div>
                                                <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Dept</label><select className="w-full p-5 bg-[#f8fafc] rounded-2xl font-bold border-none outline-none shadow-inner cursor-pointer focus:ring-2 focus:ring-[#3A9AFF]" value={formData.department} onChange={e => setFormData({...formData, department: e.target.value})}>{["기획부", "창의부", "정보부", "총무부"].map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                                            </div>
                                            <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Event Name</label><input type="text" required placeholder="명칭 입력" className="w-full p-5 bg-[#f8fafc] rounded-2xl font-bold border-none outline-none shadow-inner focus:ring-2 focus:ring-[#3A9AFF]" value={formData.event_name} onChange={e => setFormData({...formData, event_name: e.target.value})} /></div>
                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="space-y-2"><label className="text-[10px] font-black text-[#261CC1] uppercase tracking-widest ml-1">Guests</label><input type="number" className="w-full p-5 bg-[#f8fafc] rounded-2xl font-black shadow-inner border-none outline-none focus:ring-2 focus:ring-[#3A9AFF]" value={formData.total_participants} onChange={e => setFormData({...formData, total_participants: Number(e.target.value)})} /></div>
                                                <div className="space-y-2"><label className="text-[10px] font-black text-[#3A9AFF] uppercase tracking-widest ml-1">Meal Takers</label><input type="number" className="w-full p-5 bg-[#f8fafc] rounded-2xl font-black text-[#261CC1] shadow-inner border-none outline-none focus:ring-2 focus:ring-[#3A9AFF]" value={formData.meal_participants} onChange={e => setFormData({...formData, meal_participants: Number(e.target.value)})} /></div>
                                            </div>
                                            <button type="submit" className="w-full bg-[#1C0770] text-white py-6 rounded-[2.5rem] font-black shadow-2xl hover:bg-[#261CC1] transition-all flex items-center justify-center space-x-4 group">
                                                <Icon name="PlusCircle" size={22} color="#F1FF5E" />
                                                <span className="text-lg">정보 등록 완료</span>
                                            </button>
                                        </form>
                                    </div>

                                    <div className="bg-white p-12 rounded-[3.5rem] shadow-sm border border-slate-100 space-y-10 flex flex-col custom-shadow">
                                        <div className="flex items-center space-x-3 pb-6 border-b border-slate-50">
                                            <Icon name="FileSpreadsheet" size={26} color="#261CC1" />
                                            <h3 className="text-2xl font-black text-[#1C0770]">엑셀 일괄 업로드</h3>
                                        </div>
                                        <div className="bg-[#1C0770]/5 rounded-[2.5rem] p-8 space-y-5 border border-[#1C0770]/5">
                                            <div className="flex items-center gap-3 text-[#261CC1] mb-2 font-black text-sm uppercase italic"><Icon name="HelpCircle" size={18} color="#261CC1"/> User Guide</div>
                                            <div className="space-y-2">
                                                <p className="text-xs text-slate-600 font-bold flex items-center gap-2"><Icon name="Check" size={14} color="#3A9AFF"/> 첫 번째 시트의 데이터를 읽어옵니다.</p>
                                                <p className="text-xs text-slate-600 font-bold"><Icon name="Check" size={14} color="#3A9AFF" className="inline mr-1"/> 필수 컬럼명: <b>날짜, 부서, 행사명, 참석인원, 급식인원</b></p>
                                                <p className="text-xs text-slate-600 font-bold flex items-center gap-2"><Icon name="Check" size={14} color="#3A9AFF"/> 날짜 형식: <b>2024-02-20</b> (YYYY-MM-DD 권장)</p>
                                            </div>
                                        </div>
                                        <div className="flex-1 p-10 border-4 border-dashed border-[#3A9AFF]/10 rounded-[3rem] bg-[#f8fafc] flex flex-col items-center justify-center text-center space-y-8 group hover:border-[#3A9AFF]/40 transition-all">
                                            <div className="p-8 bg-white rounded-[2rem] shadow-xl text-[#3A9AFF] group-hover:scale-110 transition-transform duration-500"><Icon name="Upload" size={48} color="#3A9AFF"/></div>
                                            <input type="file" accept=".xlsx, .xls" ref={fileInputRef} onChange={handleExcelUpload} className="hidden" id="excel-upload" />
                                            <label htmlFor="excel-upload" className="px-12 py-4.5 bg-[#1C0770] text-white rounded-[1.5rem] font-black cursor-pointer hover:bg-[#261CC1] shadow-2xl active:scale-95 transition-all text-sm uppercase tracking-widest">Select File</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'list' && (
                            <div className="max-w-6xl mx-auto space-y-10 animate-fadeIn">
                                <h2 className="text-4xl font-black italic tracking-tighter uppercase text-[#1C0770]">Archive</h2>
                                <div className="bg-white rounded-[3.5rem] shadow-sm border border-slate-100 overflow-hidden custom-shadow">
                                    <table className="w-full text-left">
                                        <thead className="bg-[#1C0770] text-white">
                                            <tr>
                                                <th className="px-10 py-7 text-[11px] font-black uppercase text-center">Date</th>
                                                <th className="px-10 py-7 text-[11px] font-black uppercase">Dept</th>
                                                <th className="px-10 py-7 text-[11px] font-black uppercase">Event</th>
                                                <th className="px-10 py-7 text-[11px] font-black uppercase text-center">Meals</th>
                                                <th className="px-10 py-7 text-[11px] font-black uppercase text-center">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-50">
                                            {events.length === 0 ? (
                                                <tr><td colSpan="5" className="px-10 py-32 text-center text-slate-300 font-black italic uppercase">No Records</td></tr>
                                            ) : (
                                                [...events].reverse().map(ev => (
                                                    <tr key={ev.id} className="hover:bg-slate-50/50 transition">
                                                        <td className="px-10 py-7 text-sm font-bold text-slate-400 text-center">{ev.event_date}</td>
                                                        <td className="px-10 py-7"><span className="text-[10px] font-black bg-[#261CC1]/10 text-[#261CC1] px-4 py-1.5 rounded-full uppercase">{ev.department}</span></td>
                                                        <td className="px-10 py-7 text-base font-black text-[#1C0770]">{ev.event_name}</td>
                                                        <td className="px-10 py-7 text-center text-base font-black text-[#3A9AFF]">{ev.meal_participants}명</td>
                                                        <td className="px-10 py-7 text-center"><button onClick={() => deleteEvent(ev.id)} className="p-4 rounded-2xl transition-all text-red-300 hover:bg-red-50 hover:text-red-500 active:scale-90"><Icon name="Trash2" size={22} color="#fca5a5"/></button></td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'admin' && (
                            <div className="max-w-4xl mx-auto space-y-12 animate-fadeIn">
                                {!isAdmin ? (
                                    <div className="bg-white p-20 rounded-[5rem] shadow-2xl border border-slate-100 text-center space-y-10 custom-shadow">
                                        <div className="inline-flex p-8 bg-[#1C0770]/5 rounded-full text-[#1C0770]"><Icon name="Lock" size={64} color="#1C0770" strokeWidth={1.5} /></div>
                                        <div className="space-y-3"><h2 className="text-4xl font-black tracking-tighter italic text-[#1C0770]">Security Access</h2><p className="text-slate-400 font-bold text-lg">비밀번호를 입력하여 시스템 설정을 해제하세요.</p></div>
                                        <form onSubmit={handleAdminLogin} className="max-w-xs mx-auto space-y-5 pt-4">
                                            <input type="password" placeholder="Pass: 1416" value={pwInput} onChange={e => setPwInput(e.target.value)} className="w-full p-6 bg-[#f8fafc] border-2 border-transparent rounded-[2.5rem] text-center font-black text-2xl focus:border-[#3A9AFF] outline-none transition shadow-inner tracking-widest" />
                                            <button type="submit" className="w-full bg-[#1C0770] text-white py-6 rounded-[2.5rem] font-black hover:bg-[#261CC1] shadow-2xl transition-all text-lg uppercase tracking-widest">Authenticate</button>
                                        </form>
                                    </div>
                                ) : (
                                    <div className="space-y-12">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-4xl font-black italic text-[#1C0770]">Settings Panel</h2>
                                            <button onClick={() => { setIsAdmin(false); showMsg("로그아웃되었습니다."); }} className="px-8 py-3 bg-white text-red-600 rounded-2xl text-xs font-black hover:bg-red-50 transition uppercase border border-red-100 shadow-sm">Logout Master</button>
                                        </div>
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                                            <div className="bg-white p-12 rounded-[4rem] shadow-sm border border-slate-100 space-y-10 custom-shadow">
                                                <div className="flex items-center space-x-3 pb-8 border-b border-slate-50"><Icon name="Save" size={28} color="#3A9AFF" /><h3 className="text-2xl font-black text-[#1C0770]">운영 기준 설정</h3></div>
                                                <div className="space-y-8">
                                                    <div className="space-y-3"><label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">Max Capacity</label><input type="number" value={baseSettings.maxCapacity} onChange={e => setBaseSettings({...baseSettings, maxCapacity: Number(e.target.value)})} className="w-full p-6 bg-[#f8fafc] rounded-3xl font-black text-2xl text-[#261CC1] shadow-inner outline-none focus:ring-4 focus:ring-[#3A9AFF]/10 border-none transition" /></div>
                                                    <div className="space-y-3"><label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">Base Count</label><input type="number" value={baseSettings.baseMealCount} onChange={e => setBaseSettings({...baseSettings, baseMealCount: Number(e.target.value)})} className="w-full p-6 bg-[#f8fafc] rounded-3xl font-black text-2xl text-[#3A9AFF] shadow-inner outline-none focus:ring-4 focus:ring-[#3A9AFF]/10 border-none transition" /></div>
                                                    <div className="space-y-3">
                                                        <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">Workdays</label>
                                                        <div className="flex gap-2">
                                                            {WEEKDAYS.map((day, i) => (<button key={i} onClick={() => { const newDays = [...baseSettings.operatingDays]; newDays[i] = !newDays[i]; setBaseSettings({...baseSettings, operatingDays: newDays}); }} className={`flex-1 py-5 rounded-2xl text-xs font-black transition-all ${baseSettings.operatingDays[i] ? 'bg-[#1C0770] text-white shadow-xl' : 'bg-slate-50 text-slate-300'}`}>{day}</button>))}
                                                        </div>
                                                    </div>
                                                    <button onClick={saveSettings} disabled={loading} className="w-full bg-[#261CC1] text-white py-6 rounded-[2.5rem] font-black hover:bg-[#1C0770] shadow-2xl flex items-center justify-center gap-4 transition-all">
                                                        <Icon name={loading ? "RefreshCcw" : "Save"} size={22} color={loading ? "#3A9AFF" : "#F1FF5E"} className={loading ? "animate-spin" : ""} />
                                                        <span>서버 설정 동기화</span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="bg-white p-12 rounded-[4rem] shadow-sm border border-slate-100 space-y-10 custom-shadow">
                                                <div className="flex items-center space-x-3 pb-8 border-b border-slate-50"><Icon name="Calendar" size={28} color="#261CC1" /><h3 className="text-2xl font-black text-[#1C0770]">Live 제어 가이드</h3></div>
                                                <div className="p-10 bg-[#f8fafc] rounded-[3rem] space-y-8 border border-[#3A9AFF]/5 shadow-inner">
                                                    <p className="text-base font-bold text-slate-500 italic">"관리자 모드가 활성화되어 있습니다. 대시보드 리스트의 날짜 행을 클릭하여 실시간으로 휴무 상태를 전환할 수 있습니다."</p>
                                                    <div className="flex items-center gap-4 text-[#3A9AFF] font-black text-sm uppercase italic tracking-widest">
                                                        <div className="w-3 h-3 bg-[#F1FF5E] rounded-full animate-ping"></div> Sync Control Mode Active
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
